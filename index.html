<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SL Bus Jam - Real Logic</title>
    <style>
        :root { --ctb: #d63031; --tuk: #009432; --pickme: #f1c40f; }
        body { background: #2f3640; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; touch-action: none; }
        
        .header { padding: 10px; text-align: center; background: #1e272e; width: 100%; border-bottom: 3px solid #34495e; }

        /* ‡∂∏‡∂ú‡∑ì‡∂±‡∑ä ‡∂¥‡∑ù‡∂Ω‡∑í‡∂∏ */
        .waiting-area { 
            display: flex; gap: 8px; margin: 10px; padding: 10px; 
            background: rgba(0,0,0,0.4); border-radius: 12px; width: 90%;
            overflow-x: auto; border: 2px solid #57606f; min-height: 45px;
        }
        .passenger { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; transition: all 0.4s; }
        .p-head { width: 10px; height: 10px; border-radius: 50%; margin-bottom: 2px; }
        .p-body { width: 14px; height: 18px; border-radius: 4px 4px 1px 1px; }

        /* ‡∑É‡∑ä‡∂Ω‡∑ú‡∂ß‡∑ä‡∑É‡∑ä */
        .parking-area { display: flex; gap: 5px; margin: 10px; }
        .slot { 
            width: 45px; height: 65px; background: #353b48; border-radius: 8px; 
            border: 2px solid #718093; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; position: relative;
        }

        /* ‡∂¥‡∑ä‚Äç‡∂ª‡∂∞‡∑è‡∂± ‡∂¥‡∑è‡∂ª (Grid) */
        .game-container {
            position: relative; width: 320px; height: 400px; 
            background: #3d3d3d; border: 8px solid #222; border-radius: 20px;
            padding: 5px; box-sizing: content-box;
        }

        /* ‡∑Ä‡∑è‡∑Ñ‡∂± ‡∑É‡∑ê‡∂ö‡∑É‡∑î‡∂∏ - ‡∂ë‡∂ö ‡∑Ö‡∂ü Grid ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ω‡∑ô‡∑É */
        .vehicle { 
            position: absolute; cursor: pointer; display: flex; 
            align-items: center; justify-content: center;
            transition: all 0.4s cubic-bezier(0.45, 0.05, 0.55, 0.95);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3), 0 4px 6px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* ‡∂ä ‡∑Ñ‡∑í‡∑É (Direction Arrow) */
        .vehicle::before {
            content: '‚ñ≤'; position: absolute; color: white; font-size: 14px; opacity: 0.8;
        }
        .up::before { top: 2px; transform: rotate(0deg); }
        .down::before { bottom: 2px; transform: rotate(180deg); }
        .left::before { left: 2px; transform: rotate(-90deg); }
        .right::before { right: 2px; transform: rotate(90deg); }

        .v-ctb { border-radius: 6px; }
        .v-tuk { border-radius: 12px; }
        .v-pickme { border-radius: 8px; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 20px; text-align: center; color: black; z-index: 2000; box-shadow: 0 0 100px black; }
    </style>
</head>
<body>

    <div class="header">
        <h3 style="margin:0">LEVEL <span id="lvl">1</span></h3>
    </div>

    <div class="waiting-area" id="p-queue"></div>

    <div class="parking-area">
        <div class="slot" id="s0"></div><div class="slot" id="s1"></div>
        <div class="slot" id="s2"></div><div class="slot" id="s3"></div>
        <div class="slot" id="s4"></div><div class="slot" id="s5"></div>
    </div>

    <div class="game-container" id="game-map"></div>

    <div id="win-modal" class="modal">
        <h1 style="color: #2ecc71;">‡∂∏‡∑ì‡∑Ö‡∂ü ‡∂∏‡∂ß‡∑ä‡∂ß‡∂∏! üéâ</h1>
        <button onclick="nextLevel()" style="padding: 15px 30px; background: #2ecc71; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer;">START</button>
    </div>

    <script>
        let level = 1;
        let queue = [];
        let slots = [null, null, null, null, null, null];
        const cellSize = 52; // ‡∑Ä‡∑è‡∑Ñ‡∂± ‡∂ë‡∂ö ‡∑Ö‡∂ü ‡∂≠‡∑ê‡∂∂‡∑ì‡∂∏‡∂ß ‡∑É‡∑õ‡∂Ω‡∂∫‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∂∫

        const vData = {
            ctb: { id: 'ctb', color: '#d63031', seats: 8, len: 2 },
            tuk: { id: 'tuk', color: '#009432', seats: 3, len: 1 },
            pickme: { id: 'pickme', color: '#f1c40f', seats: 4, len: 1.5 }
        };

        function init() {
            const pCount = 10 + (level * 4);
            queue = Array.from({length: pCount}, () => Object.values(vData)[Math.floor(Math.random()*3)]);
            slots = [null, null, null, null, null, null];
            document.getElementById('lvl').innerText = level;
            document.getElementById('game-map').innerHTML = '';
            document.getElementById('win-modal').style.display = 'none';
            renderQueue();
            renderSlots();
            createJam();
        }

        function createJam() {
            const map = document.getElementById('game-map');
            const dirs = ['up', 'down', 'left', 'right'];
            
            // Grid ‡∂ë‡∂ö ‡∂¥‡∑î‡∂ª‡∑è ‡∑Ä‡∑è‡∑Ñ‡∂± 12-15‡∂ö‡∑ä ‡∂¥‡∂∏‡∂´ ‡∂¥‡∑í‡∑Ö‡∑í‡∑Ä‡∑ô‡∑Ö‡∂ö‡∂ß ‡∂Ö‡∑É‡∑î‡∂ª‡∂∏‡∑î
            for(let r=0; r<6; r++) {
                for(let c=0; c<5; c++) {
                    if(Math.random() > 0.4) { // 60% ‡∂ö ‡∂â‡∂©‡∂ö‡∑ä ‡∑Ä‡∑è‡∑Ñ‡∂± ‡∑Ä‡∂Ω‡∑í‡∂±‡∑ä ‡∂¥‡∑î‡∂ª‡∑Ä‡∂∏‡∑î
                        const type = Object.values(vData)[Math.floor(Math.random()*3)];
                        const dir = dirs[Math.floor(Math.random()*4)];
                        const v = document.createElement('div');
                        
                        v.className = `vehicle v-${type.id} ${dir}`;
                        v.style.background = type.color;
                        
                        // ‡∂Ø‡∑í‡∑Å‡∑è‡∑Ä ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂Ø‡∑í‡∂ú ‡∂¥‡∑Ö‡∂Ω
                        if(dir === 'up' || dir === 'down') {
                            v.style.width = "48px"; v.style.height = (type.len * 48) + "px";
                        } else {
                            v.style.width = (type.len * 48) + "px"; v.style.height = "48px";
                        }

                        v.style.top = (r * 60 + 5) + "px";
                        v.style.left = (c * 60 + 5) + "px";
                        
                        v.onclick = (e) => { e.stopPropagation(); moveVehicle(v, type, dir); };
                        map.appendChild(v);
                    }
                }
            }
        }

        function moveVehicle(v, type, dir) {
            // ‡∂ú‡∂∏‡∂±‡∑ä ‡∂¥‡∂Æ‡∂∫ ‡∂Ö‡∑Ä‡∑Ñ‡∑í‡∂ª ‡∑Ä‡∑ì ‡∂á‡∂≠‡∑ä‡∂Ø‡∑ê‡∂∫‡∑í ‡∂∂‡∑ê‡∂Ω‡∑ì‡∂∏ (‡∑É‡∂ª‡∂Ω ‡∂ö‡∑Ö ‡∂Ö‡∂±‡∑î‡∑Ä‡∑è‡∂Ø‡∂∫)
            const emptySlot = slots.indexOf(null);
            if(emptySlot === -1) return;

            // ‡∑Ä‡∑è‡∑Ñ‡∂±‡∂∫ ‡∂â‡∂Ø‡∑í‡∂ª‡∑í‡∂∫‡∂ß ‡∂ú‡∑ú‡∑É‡∑ä ‡∂±‡∑ú‡∂¥‡∑ô‡∂±‡∑ì ‡∂∫‡∑è‡∂∏ (‡∑É‡∑ä‡∂Ω‡∑ú‡∂ß‡∑ä ‡∂ë‡∂ö‡∂ß ‡∂∫‡∂± ‡∂∂‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∑ì‡∂∏‡∂ß)
            v.style.zIndex = "1000";
            if(dir === 'up') v.style.top = "-200px";
            else if(dir === 'down') v.style.top = "600px";
            else if(dir === 'left') v.style.left = "-200px";
            else if(dir === 'right') v.style.left = "600px";
            
            v.style.opacity = "0";

            setTimeout(() => {
                slots[emptySlot] = { ...type, filled: 0 };
                v.remove();
                renderSlots();
                processBoarding();
            }, 400);
        }

        function renderQueue() {
            const q = document.getElementById('p-queue');
            q.innerHTML = '';
            queue.forEach(p => {
                const d = document.createElement('div');
                d.className = 'passenger';
                d.innerHTML = `<div class="p-head" style="background:${p.color}"></div>
                               <div class="p-body" style="background:${p.color}"></div>`;
                q.appendChild(d);
            });
        }

        function renderSlots() {
            slots.forEach((s, i) => {
                const el = document.getElementById(`s${i}`);
                if (s) {
                    el.style.background = s.color;
                    el.innerHTML = `<div style="font-size:18px">üöå</div><div style="font-size:10px; font-weight:bold">${s.filled}/${s.seats}</div>`;
                } else {
                    el.style.background = '#353b48'; el.innerHTML = '';
                }
            });
        }

        function processBoarding() {
            if (queue.length === 0) return;
            const nextP = queue[0];
            const sIdx = slots.findIndex(s => s && s.id === nextP.id && s.filled < s.seats);

            if (sIdx !== -1) {
                queue.shift();
                slots[sIdx].filled++;
                renderQueue();
                renderSlots();

                if (slots[sIdx].filled === slots[sIdx].seats) {
                    setTimeout(() => {
                        slots[sIdx] = null;
                        renderSlots();
                        processBoarding();
                        if(queue.length === 0 && slots.every(s => s === null)) 
                            document.getElementById('win-modal').style.display = 'block';
                    }, 300);
                } else {
                    setTimeout(processBoarding, 100);
                }
            }
        }

        function nextLevel() { level++; init(); }
        init();
    </script>
</body>
</html>
